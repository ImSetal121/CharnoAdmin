# 前端管理页面开发规范

## 核心原则

**管理页面负责实现实体（Entity）的完整CRUD功能，包括列表展示、条件查询、分页、排序、新增、编辑、删除等操作。所有管理页面应遵循统一的结构、状态管理和交互模式，确保用户体验一致。**

## 页面结构规范

### 目录结构

**管理页面应按照功能模块组织，位于 `src/pages/{模块名}/{实体名}/` 目录下。**

```
src/pages/
└── System/                      # 系统模块
    ├── Users/                   # 用户管理
    │   └── index.tsx            # 用户管理页面
    └── Roles/                   # 角色管理
        └── index.tsx            # 角色管理页面
```

### 文件命名

- **使用 PascalCase**：文件夹名和文件名使用 PascalCase（首字母大写）
- **主文件命名为 `index.tsx`**：每个管理页面目录下的主文件统一命名为 `index.tsx`

## 页面内容结构

### 标准页面结构

每个管理页面应包含以下部分（按顺序）：

1. **页面标题区域** - 显示页面标题和描述，包含操作按钮（新增、注册等）
2. **搜索表单区域** - 条件查询表单（Card 组件包裹）
3. **数据表格区域** - 数据列表展示（Card 组件包裹）
4. **分页组件** - 位于表格下方
5. **新增/编辑对话框** - Dialog 组件
6. **删除确认对话框** - AlertDialog 组件

### 页面布局示例

```tsx
export default function EntityPage() {
  // 状态管理
  // 表单定义
  // 事件处理函数
  
  return (
    <div className="space-y-6">
      {/* 1. 页面标题区域 */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold tracking-tight">实体管理</h1>
          <p className="text-muted-foreground">管理系统实体信息</p>
        </div>
        <div className="flex gap-2">
          <Button onClick={handleOpenModal}>
            <Plus className="mr-2 h-4 w-4" />
            新增实体
          </Button>
        </div>
      </div>

      {/* 2. 搜索表单区域 */}
      <Card>
        <CardHeader>
          <CardTitle>搜索条件</CardTitle>
        </CardHeader>
        <CardContent>
          {/* 搜索表单 */}
        </CardContent>
      </Card>

      {/* 3. 数据表格区域 */}
      <Card>
        <CardHeader>
          <CardTitle>实体列表</CardTitle>
          <CardDescription>共 {total} 条记录</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="rounded-md border">
            <Table>
              {/* 表格内容 */}
            </Table>
          </div>
          {/* 分页组件 */}
        </CardContent>
      </Card>

      {/* 4. 新增/编辑对话框 */}
      {/* 5. 删除确认对话框 */}
    </div>
  );
}
```

## 状态管理规范

### 必需状态

每个管理页面必须包含以下状态：

```typescript
// 数据列表
const [entities, setEntities] = useState<Entity[]>([]);

// 加载状态
const [loading, setLoading] = useState(false);

// 分页相关
const [total, setTotal] = useState(0);
const [currentPage, setCurrentPage] = useState(1);
const [pageSize, setPageSize] = useState(10);

// 查询条件
const [queryParams, setQueryParams] = useState<EntityPageQueryParams>({
  page: 0,
  size: 10,
});

// 排序相关
const [sortField, setSortField] = useState<string | null>(null);
const [sortDirection, setSortDirection] = useState<'asc' | 'desc' | null>(null);

// 对话框状态
const [visible, setVisible] = useState(false);
const [editingEntity, setEditingEntity] = useState<Entity | null>(null);
const [entityToDelete, setEntityToDelete] = useState<Entity | null>(null);
```

### 状态初始化

- **分页状态**：`currentPage` 从 1 开始，`pageSize` 默认为 10
- **查询参数**：`queryParams.page` 从 0 开始（后端要求）
- **排序状态**：初始为 `null`（使用后端默认排序）

## 表单管理规范

### 使用 react-hook-form

所有表单应使用 `react-hook-form` 和 `zod` 进行管理和验证：

```typescript
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';

// 定义验证规则
const entitySchema = z.object({
  field1: z.string().min(1, '字段1不能为空'),
  field2: z.string().optional(),
});

// 创建表单实例
const form = useForm<Entity>({
  resolver: zodResolver(entitySchema),
  defaultValues: {},
});

// 搜索表单
const searchForm = useForm<EntityPageQueryParams>({
  defaultValues: {},
});
```

### 表单类型

每个管理页面通常需要两个表单：

1. **搜索表单** - 用于条件查询
2. **编辑表单** - 用于新增/编辑实体

## 数据加载规范

### 加载函数

每个管理页面应包含一个数据加载函数：

```typescript
// 加载实体列表
const loadEntities = async () => {
  setLoading(true);
  try {
    // 构建排序参数
    const sortParam = sortField && sortDirection 
      ? `${sortField},${sortDirection}` 
      : undefined;
    
    // 构建查询参数
    const params: EntityPageQueryParams = {
      ...queryParams,
      page: currentPage - 1,  // 前端从1开始，后端从0开始
      size: pageSize,
      sort: sortParam,
    };
    
    // 调用API
    const result = await queryEntitiesWithPage(params);
    
    // 更新状态
    setEntities(result.data);
    setTotal(result.total);
  } catch (error: any) {
    toast.error(error.message || '加载数据失败');
  } finally {
    setLoading(false);
  }
};
```

### 自动加载

使用 `useEffect` 监听相关状态变化，自动触发数据加载：

```typescript
useEffect(() => {
  loadEntities();
}, [currentPage, pageSize, queryParams, sortField, sortDirection]);
```

**注意：** 不要在依赖数组中包含 `loadEntities` 函数，避免无限循环。

## 排序功能规范

### 排序状态管理

```typescript
const [sortField, setSortField] = useState<string | null>(null);
const [sortDirection, setSortDirection] = useState<'asc' | 'desc' | null>(null);
```

### 排序处理函数

```typescript
// 处理排序点击
const handleSort = (field: string) => {
  if (sortField === field) {
    // 同一字段：asc -> desc -> null
    if (sortDirection === 'asc') {
      setSortDirection('desc');
    } else if (sortDirection === 'desc') {
      setSortField(null);
      setSortDirection(null);
    }
  } else {
    // 不同字段：设置为 asc
    setSortField(field);
    setSortDirection('asc');
  }
};
```

### 排序参数构建

```typescript
const sortParam = sortField && sortDirection 
  ? `${sortField},${sortDirection}` 
  : undefined;
```

### 表头使用

**可排序字段使用 `SortableTableHead` 组件：**

```tsx
<SortableTableHead
  field="fieldName"
  sortField={sortField}
  sortDirection={sortDirection}
  onSort={handleSort}
>
  字段显示名
</SortableTableHead>
```

**不可排序字段使用普通 `TableHead` 组件：**

```tsx
<TableHead>字段显示名</TableHead>
```

### 字段映射

**前端字段名必须与后端实体类的 Java 字段名一致：**

- 使用驼峰命名（camelCase）
- 注意大小写
- 关联字段使用数据库列名（如 `role_code` 在 Java 中可能是 `roleCode`，需要确认）

## 分页功能规范

### 分页状态

```typescript
const [currentPage, setCurrentPage] = useState(1);  // 前端从1开始
const [pageSize, setPageSize] = useState(10);
const [total, setTotal] = useState(0);
```

### 分页参数传递

```typescript
const params: EntityPageQueryParams = {
  ...queryParams,
  page: currentPage - 1,  // 转换为后端格式（从0开始）
  size: pageSize,
  sort: sortParam,
};
```

### 分页组件

使用 shadcn/ui 的 `Pagination` 组件：

```tsx
{totalPages > 1 && (
  <div className="mt-4">
    <Pagination>
      <PaginationContent>
        <PaginationItem>
          <PaginationPrevious
            href="#"
            onClick={(e) => {
              e.preventDefault();
              if (currentPage > 1) setCurrentPage(currentPage - 1);
            }}
            className={currentPage === 1 ? 'pointer-events-none opacity-50' : ''}
          />
        </PaginationItem>
        {Array.from({ length: totalPages }, (_, i) => i + 1).map((page) => (
          <PaginationItem key={page}>
            <PaginationLink
              href="#"
              onClick={(e) => {
                e.preventDefault();
                setCurrentPage(page);
              }}
              isActive={currentPage === page}
            >
              {page}
            </PaginationLink>
          </PaginationItem>
        ))}
        <PaginationItem>
          <PaginationNext
            href="#"
            onClick={(e) => {
              e.preventDefault();
              if (currentPage < totalPages) setCurrentPage(currentPage + 1);
            }}
            className={currentPage === totalPages ? 'pointer-events-none opacity-50' : ''}
          />
        </PaginationItem>
      </PaginationContent>
    </Pagination>
  </div>
)}
```

### 总页数计算

```typescript
const totalPages = Math.ceil(total / pageSize);
```

## 搜索功能规范

### 搜索表单

使用 `react-hook-form` 管理搜索表单：

```typescript
const searchForm = useForm<EntityPageQueryParams>({
  defaultValues: {},
});
```

### 搜索处理

```typescript
// 处理搜索
const handleSearch = (values: EntityPageQueryParams) => {
  setQueryParams({
    ...values,
    page: 0,
    size: pageSize,
  });
  setCurrentPage(1);  // 重置到第一页
};

// 处理重置
const handleReset = () => {
  searchForm.reset();
  setQueryParams({
    page: 0,
    size: pageSize,
  });
  setCurrentPage(1);
};
```

### 搜索表单布局

使用响应式网格布局：

```tsx
<Form {...searchForm}>
  <form onSubmit={searchForm.handleSubmit(handleSearch)} className="space-y-4">
    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
      {/* 搜索字段 */}
    </div>
    <div className="flex gap-2">
      <Button type="submit">
        <Search className="mr-2 h-4 w-4" />
        查询
      </Button>
      <Button type="button" variant="outline" onClick={handleReset}>
        重置
      </Button>
    </div>
  </form>
</Form>
```

## CRUD 操作规范

### 创建（Create）

```typescript
// 打开新增对话框
const handleOpenModal = (entity?: Entity) => {
  if (entity) {
    setEditingEntity(entity);
    form.reset(entity);
  } else {
    setEditingEntity(null);
    form.reset({});
  }
  setVisible(true);
};

// 保存实体
const handleSave = async (values: Entity) => {
  try {
    if (editingEntity?.id) {
      // 更新
      await updateEntity(editingEntity.id, values);
      toast.success('更新成功');
    } else {
      // 新增
      await createEntity(values);
      toast.success('创建成功');
    }
    handleCloseModal();
    loadEntities();  // 重新加载数据
  } catch (error: any) {
    toast.error(error.message || '操作失败');
  }
};
```

### 读取（Read）

数据加载已在"数据加载规范"中说明。

### 更新（Update）

更新操作与创建操作共用同一个对话框，通过 `editingEntity` 状态区分。

### 删除（Delete）

```typescript
// 删除确认
const handleDeleteConfirm = async () => {
  if (!entityToDelete?.id) return;
  try {
    await deleteEntity(entityToDelete.id);
    toast.success('删除成功');
    setEntityToDelete(null);
    loadEntities();  // 重新加载数据
  } catch (error: any) {
    toast.error(error.message || '删除失败');
  }
};
```

## 表格展示规范

### 表格结构

```tsx
<div className="rounded-md border">
  <Table>
    <TableHeader>
      <TableRow>
        {/* 表头 */}
      </TableRow>
    </TableHeader>
    <TableBody>
      {loading ? (
        <TableRow>
          <TableCell colSpan={列数} className="text-center">
            <Loader2 className="h-4 w-4 animate-spin inline-block mr-2" />
            加载中...
          </TableCell>
        </TableRow>
      ) : entities.length === 0 ? (
        <TableRow>
          <TableCell colSpan={列数} className="text-center">
            暂无数据
          </TableCell>
        </TableRow>
      ) : (
        entities.map((entity) => (
          <TableRow key={entity.id}>
            {/* 表格行内容 */}
          </TableRow>
        ))
      )}
    </TableBody>
  </Table>
</div>
```

### 操作列

操作列应位于表格最右侧，包含编辑和删除按钮：

```tsx
<TableCell className="text-right">
  <div className="flex justify-end gap-2">
    <Button
      variant="ghost"
      size="sm"
      onClick={() => handleOpenModal(entity)}
    >
      <Edit className="h-4 w-4" />
    </Button>
    <Button
      variant="ghost"
      size="sm"
      onClick={() => setEntityToDelete(entity)}
    >
      <Trash2 className="h-4 w-4 text-destructive" />
    </Button>
  </div>
</TableCell>
```

## 对话框规范

### 新增/编辑对话框

使用 `Dialog` 组件：

```tsx
<Dialog open={visible} onOpenChange={setVisible}>
  <DialogContent className="sm:max-w-[700px] max-h-[90vh] overflow-y-auto">
    <DialogHeader>
      <DialogTitle>{editingEntity ? '编辑实体' : '新增实体'}</DialogTitle>
      <DialogDescription>
        {editingEntity ? '修改实体信息' : '创建新的系统实体'}
      </DialogDescription>
    </DialogHeader>
    <Form {...form}>
      <form onSubmit={form.handleSubmit(handleSave)} className="space-y-4">
        {/* 表单字段 */}
        <DialogFooter>
          <Button type="button" variant="outline" onClick={handleCloseModal}>
            取消
          </Button>
          <Button type="submit">保存</Button>
        </DialogFooter>
      </form>
    </Form>
  </DialogContent>
</Dialog>
```

### 删除确认对话框

使用 `AlertDialog` 组件：

```tsx
<AlertDialog open={!!entityToDelete} onOpenChange={(open) => !open && setEntityToDelete(null)}>
  <AlertDialogContent>
    <AlertDialogHeader>
      <AlertDialogTitle>确认删除</AlertDialogTitle>
      <AlertDialogDescription>
        确定要删除实体 "{entityToDelete?.name || entityToDelete?.id}" 吗？此操作不可撤销。
      </AlertDialogDescription>
    </AlertDialogHeader>
    <AlertDialogFooter>
      <AlertDialogCancel>取消</AlertDialogCancel>
      <AlertDialogAction onClick={handleDeleteConfirm}>删除</AlertDialogAction>
    </AlertDialogFooter>
  </AlertDialogContent>
</AlertDialog>
```

## 错误处理规范

### API 调用错误处理

所有 API 调用都应包含错误处理：

```typescript
try {
  // API 调用
  await someApiCall();
  toast.success('操作成功');
} catch (error: any) {
  toast.error(error.message || '操作失败');
}
```

### 表单验证错误

使用 `react-hook-form` 的自动验证，错误信息通过 `FormMessage` 组件显示：

```tsx
<FormField
  control={form.control}
  name="fieldName"
  render={({ field }) => (
    <FormItem>
      <FormLabel>字段名</FormLabel>
      <FormControl>
        <Input {...field} />
      </FormControl>
      <FormMessage />
    </FormItem>
  )}
/>
```

## 工具函数规范

### 日期格式化

```typescript
const formatDate = (date?: string) => {
  if (!date) return '-';
  return new Date(date).toLocaleString('zh-CN');
};
```

### 枚举值转换

```typescript
const getStatusBadge = (status?: string) => {
  const statusMap: Record<string, { text: string; variant: 'default' | 'destructive' | 'secondary' }> = {
    ENABLED: { text: '启用', variant: 'default' },
    DISABLED: { text: '禁用', variant: 'destructive' },
  };
  const statusInfo = statusMap[status || ''] || { text: status || '-', variant: 'secondary' as const };
  return <Badge variant={statusInfo.variant}>{statusInfo.text}</Badge>;
};
```

## 导入规范

### 标准导入顺序

1. React 相关
2. 第三方库（react-hook-form, zod 等）
3. UI 组件（shadcn/ui）
4. 图标（lucide-react）
5. 类型定义
6. API 函数
7. 工具函数（toast 等）

```typescript
import { useState, useEffect } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import { Plus, Search, Edit, Trash2, Loader2 } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { SortableTableHead } from '@/components/ui/sortable-table-head';
import type { Entity, EntityPageQueryParams } from '@/types';
import { queryEntitiesWithPage, createEntity, updateEntity, deleteEntity } from '@/api/system/AdminEntity';
import { toast } from 'sonner';
```

## 完整示例

### 示例：实体管理页面

```tsx
import { useState, useEffect } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import { Plus, Search, Edit, Trash2, Loader2 } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import { SortableTableHead } from '@/components/ui/sortable-table-head';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import {
  Pagination,
  PaginationContent,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
} from '@/components/ui/pagination';
import type { Entity, EntityPageQueryParams } from '@/types';
import {
  queryEntitiesWithPage,
  createEntity,
  updateEntity,
  deleteEntity,
} from '@/api/system/AdminEntity';
import { toast } from 'sonner';

const entitySchema = z.object({
  name: z.string().min(1, '名称不能为空'),
  code: z.string().min(2, '代码至少2个字符'),
});

export default function EntityPage() {
  // 状态管理
  const [entities, setEntities] = useState<Entity[]>([]);
  const [loading, setLoading] = useState(false);
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10);
  const [visible, setVisible] = useState(false);
  const [editingEntity, setEditingEntity] = useState<Entity | null>(null);
  const [entityToDelete, setEntityToDelete] = useState<Entity | null>(null);
  const [queryParams, setQueryParams] = useState<EntityPageQueryParams>({
    page: 0,
    size: 10,
  });
  const [sortField, setSortField] = useState<string | null>(null);
  const [sortDirection, setSortDirection] = useState<'asc' | 'desc' | null>(null);

  // 表单定义
  const form = useForm<Entity>({
    resolver: zodResolver(entitySchema),
    defaultValues: {},
  });

  const searchForm = useForm<EntityPageQueryParams>({
    defaultValues: {},
  });

  // 处理排序点击
  const handleSort = (field: string) => {
    if (sortField === field) {
      if (sortDirection === 'asc') {
        setSortDirection('desc');
      } else if (sortDirection === 'desc') {
        setSortField(null);
        setSortDirection(null);
      }
    } else {
      setSortField(field);
      setSortDirection('asc');
    }
  };

  // 加载实体列表
  const loadEntities = async () => {
    setLoading(true);
    try {
      const sortParam = sortField && sortDirection 
        ? `${sortField},${sortDirection}` 
        : undefined;
      
      const params: EntityPageQueryParams = {
        ...queryParams,
        page: currentPage - 1,
        size: pageSize,
        sort: sortParam,
      };
      const result = await queryEntitiesWithPage(params);
      setEntities(result.data);
      setTotal(result.total);
    } catch (error: any) {
      toast.error(error.message || '加载数据失败');
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadEntities();
  }, [currentPage, pageSize, queryParams, sortField, sortDirection]);

  // 处理搜索
  const handleSearch = (values: EntityPageQueryParams) => {
    setQueryParams({
      ...values,
      page: 0,
      size: pageSize,
    });
    setCurrentPage(1);
  };

  // 处理重置
  const handleReset = () => {
    searchForm.reset();
    setQueryParams({
      page: 0,
      size: pageSize,
    });
    setCurrentPage(1);
  };

  // 打开新增/编辑弹窗
  const handleOpenModal = (entity?: Entity) => {
    if (entity) {
      setEditingEntity(entity);
      form.reset(entity);
    } else {
      setEditingEntity(null);
      form.reset({});
    }
    setVisible(true);
  };

  // 关闭弹窗
  const handleCloseModal = () => {
    setVisible(false);
    setEditingEntity(null);
    form.reset({});
  };

  // 保存实体
  const handleSave = async (values: Entity) => {
    try {
      if (editingEntity?.id) {
        await updateEntity(editingEntity.id, values);
        toast.success('更新成功');
      } else {
        await createEntity(values);
        toast.success('创建成功');
      }
      handleCloseModal();
      loadEntities();
    } catch (error: any) {
      toast.error(error.message || '操作失败');
    }
  };

  // 删除实体
  const handleDeleteConfirm = async () => {
    if (!entityToDelete?.id) return;
    try {
      await deleteEntity(entityToDelete.id);
      toast.success('删除成功');
      setEntityToDelete(null);
      loadEntities();
    } catch (error: any) {
      toast.error(error.message || '删除失败');
    }
  };

  const totalPages = Math.ceil(total / pageSize);

  return (
    <div className="space-y-6">
      {/* 页面标题区域 */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold tracking-tight">实体管理</h1>
          <p className="text-muted-foreground">管理系统实体信息</p>
        </div>
        <Button onClick={() => handleOpenModal()}>
          <Plus className="mr-2 h-4 w-4" />
          新增实体
        </Button>
      </div>

      {/* 搜索表单区域 */}
      <Card>
        <CardHeader>
          <CardTitle>搜索条件</CardTitle>
        </CardHeader>
        <CardContent>
          <Form {...searchForm}>
            <form onSubmit={searchForm.handleSubmit(handleSearch)} className="space-y-4">
              <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                <FormField
                  control={searchForm.control}
                  name="name"
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>名称</FormLabel>
                      <FormControl>
                        <Input placeholder="请输入名称" {...field} />
                      </FormControl>
                    </FormItem>
                  )}
                />
              </div>
              <div className="flex gap-2">
                <Button type="submit">
                  <Search className="mr-2 h-4 w-4" />
                  查询
                </Button>
                <Button type="button" variant="outline" onClick={handleReset}>
                  重置
                </Button>
              </div>
            </form>
          </Form>
        </CardContent>
      </Card>

      {/* 数据表格区域 */}
      <Card>
        <CardHeader>
          <CardTitle>实体列表</CardTitle>
          <CardDescription>共 {total} 条记录</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="rounded-md border">
            <Table>
              <TableHeader>
                <TableRow>
                  <SortableTableHead
                    field="code"
                    sortField={sortField}
                    sortDirection={sortDirection}
                    onSort={handleSort}
                  >
                    代码
                  </SortableTableHead>
                  <SortableTableHead
                    field="name"
                    sortField={sortField}
                    sortDirection={sortDirection}
                    onSort={handleSort}
                  >
                    名称
                  </SortableTableHead>
                  <SortableTableHead
                    field="createdAt"
                    sortField={sortField}
                    sortDirection={sortDirection}
                    onSort={handleSort}
                  >
                    创建时间
                  </SortableTableHead>
                  <TableHead className="text-right">操作</TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {loading ? (
                  <TableRow>
                    <TableCell colSpan={4} className="text-center">
                      <Loader2 className="h-4 w-4 animate-spin inline-block mr-2" />
                      加载中...
                    </TableCell>
                  </TableRow>
                ) : entities.length === 0 ? (
                  <TableRow>
                    <TableCell colSpan={4} className="text-center">
                      暂无数据
                    </TableCell>
                  </TableRow>
                ) : (
                  entities.map((entity) => (
                    <TableRow key={entity.id}>
                      <TableCell>{entity.code}</TableCell>
                      <TableCell>{entity.name}</TableCell>
                      <TableCell>{formatDate(entity.createdAt)}</TableCell>
                      <TableCell className="text-right">
                        <div className="flex justify-end gap-2">
                          <Button
                            variant="ghost"
                            size="sm"
                            onClick={() => handleOpenModal(entity)}
                          >
                            <Edit className="h-4 w-4" />
                          </Button>
                          <Button
                            variant="ghost"
                            size="sm"
                            onClick={() => setEntityToDelete(entity)}
                          >
                            <Trash2 className="h-4 w-4 text-destructive" />
                          </Button>
                        </div>
                      </TableCell>
                    </TableRow>
                  ))
                )}
              </TableBody>
            </Table>
          </div>

          {/* 分页 */}
          {totalPages > 1 && (
            <div className="mt-4">
              <Pagination>
                <PaginationContent>
                  <PaginationItem>
                    <PaginationPrevious
                      href="#"
                      onClick={(e) => {
                        e.preventDefault();
                        if (currentPage > 1) setCurrentPage(currentPage - 1);
                      }}
                      className={currentPage === 1 ? 'pointer-events-none opacity-50' : ''}
                    />
                  </PaginationItem>
                  {Array.from({ length: totalPages }, (_, i) => i + 1).map((page) => (
                    <PaginationItem key={page}>
                      <PaginationLink
                        href="#"
                        onClick={(e) => {
                          e.preventDefault();
                          setCurrentPage(page);
                        }}
                        isActive={currentPage === page}
                      >
                        {page}
                      </PaginationLink>
                    </PaginationItem>
                  ))}
                  <PaginationItem>
                    <PaginationNext
                      href="#"
                      onClick={(e) => {
                        e.preventDefault();
                        if (currentPage < totalPages) setCurrentPage(currentPage + 1);
                      }}
                      className={currentPage === totalPages ? 'pointer-events-none opacity-50' : ''}
                    />
                  </PaginationItem>
                </PaginationContent>
              </Pagination>
            </div>
          )}
        </CardContent>
      </Card>

      {/* 新增/编辑对话框 */}
      <Dialog open={visible} onOpenChange={setVisible}>
        <DialogContent className="sm:max-w-[600px]">
          <DialogHeader>
            <DialogTitle>{editingEntity ? '编辑实体' : '新增实体'}</DialogTitle>
            <DialogDescription>
              {editingEntity ? '修改实体信息' : '创建新的系统实体'}
            </DialogDescription>
          </DialogHeader>
          <Form {...form}>
            <form onSubmit={form.handleSubmit(handleSave)} className="space-y-4">
              <FormField
                control={form.control}
                name="code"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>代码</FormLabel>
                    <FormControl>
                      <Input
                        placeholder="请输入代码"
                        disabled={!!editingEntity?.id}
                        {...field}
                      />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />
              <FormField
                control={form.control}
                name="name"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>名称</FormLabel>
                    <FormControl>
                      <Input placeholder="请输入名称" {...field} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />
              <DialogFooter>
                <Button type="button" variant="outline" onClick={handleCloseModal}>
                  取消
                </Button>
                <Button type="submit">保存</Button>
              </DialogFooter>
            </form>
          </Form>
        </DialogContent>
      </Dialog>

      {/* 删除确认对话框 */}
      <AlertDialog open={!!entityToDelete} onOpenChange={(open) => !open && setEntityToDelete(null)}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>确认删除</AlertDialogTitle>
            <AlertDialogDescription>
              确定要删除实体 "{entityToDelete?.name || entityToDelete?.id}" 吗？此操作不可撤销。
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>取消</AlertDialogCancel>
            <AlertDialogAction onClick={handleDeleteConfirm}>删除</AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </div>
  );
}
```

## ❌ 禁止事项

1. **禁止在 useEffect 依赖中包含函数**
   ```typescript
   // ❌ 错误：会导致无限循环
   useEffect(() => {
     loadEntities();
   }, [loadEntities]);
   
   // ✅ 正确：只包含状态依赖
   useEffect(() => {
     loadEntities();
   }, [currentPage, pageSize, queryParams, sortField, sortDirection]);
   ```

2. **禁止直接使用 data.length 作为总数**
   ```typescript
   // ❌ 错误：这只是当前页的数据长度
   setTotal(data.length);
   
   // ✅ 正确：使用 API 返回的 total
   setTotal(result.total);
   ```

3. **禁止在前端对分页数据进行排序**
   ```typescript
   // ❌ 错误：只对当前页数据排序
   const sortedData = data.sort((a, b) => a.name.localeCompare(b.name));
   
   // ✅ 正确：通过 sort 参数让后端对所有数据排序
   const sortParam = `${sortField},${sortDirection}`;
   ```

4. **禁止忘记重置页码**
   ```typescript
   // ❌ 错误：搜索后可能停留在不存在的页码
   const handleSearch = (values) => {
     setQueryParams(values);
   };
   
   // ✅ 正确：搜索时重置到第一页
   const handleSearch = (values) => {
     setQueryParams({ ...values, page: 0 });
     setCurrentPage(1);
   };
   ```

5. **禁止在排序状态变化时不重新加载数据**
   ```typescript
   // ❌ 错误：排序状态变化但数据不更新
   useEffect(() => {
     loadEntities();
   }, [currentPage, pageSize, queryParams]);
   
   // ✅ 正确：包含排序状态
   useEffect(() => {
     loadEntities();
   }, [currentPage, pageSize, queryParams, sortField, sortDirection]);
   ```

## ✅ 检查清单

创建新的管理页面时，请检查：

- [ ] 页面位于正确的目录结构下（`src/pages/{模块名}/{实体名}/index.tsx`）
- [ ] 包含所有必需的状态管理（数据列表、加载状态、分页、排序、查询条件）
- [ ] 实现了数据加载函数，正确处理 PageResult 结构
- [ ] 实现了排序功能（handleSort 函数和 SortableTableHead 组件）
- [ ] 实现了搜索和重置功能
- [ ] 实现了 CRUD 操作（创建、读取、更新、删除）
- [ ] 使用了 react-hook-form 和 zod 进行表单验证
- [ ] 包含了加载中和空数据状态的处理
- [ ] 包含了错误处理和用户提示（toast）
- [ ] 分页组件正确实现，总页数计算正确
- [ ] 对话框正确实现（新增/编辑、删除确认）
- [ ] 表头使用了 SortableTableHead 组件（可排序字段）
- [ ] 字段名与后端实体类字段名一致
- [ ] useEffect 依赖数组正确，不包含函数

## 优势

1. **统一体验**：所有管理页面遵循相同的结构和交互模式
2. **易于维护**：标准化的代码结构便于理解和维护
3. **功能完整**：包含完整的 CRUD、搜索、排序、分页功能
4. **类型安全**：完整的 TypeScript 类型定义
5. **用户体验**：统一的加载状态、错误提示、空数据提示

